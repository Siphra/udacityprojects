define(["jquery","underscore","globals","marionette","moment","location-utils","jquery-ui"],function(e,t,i,o,s,l){var n=function(e){var t=e;return t=t.replace(/[\(,\),\-,\s]/g,"").replace(/\D/g,function(e){for(var t=["ABC","DEF","GHI","JKL","MNO","PQRS","TUV","WXYZ"],i=0;i<t.length;i++)if(t[i].indexOf(e)!=-1)return i+2}),t="+1"+t},r={};return r.NoShowtimesView=o.ItemView.extend({className:"no-showtimes panel panel-rt panel-box",template:t.template(e("script.NoShowtimesTemplateShowtimes").html()),initialize:function(e){this.el=e.el}}),r.ShowMoreTheatersButton=o.ItemView.extend({events:{click:"onShowMoreClicked"},initialize:function(e){this.controller=e.controller,this.el=e.showMoreButtonId,this.listenTo(this.showtimesQueryModel,"change:limit",this.render)},render:function(){this.showtimesQueryModel.isLimitMaximum()?this.$el.hide():this.$el.show()},onShowMoreClicked:function(){this.controller.onShowMore()}}),r.OpeningOnView=o.ItemView.extend({className:"opening-on-panel panel panel-rt panel-box",template:t.template(e("script.OpeningOnTemplate").html()),initialize:function(e){this.controller=e.controller},events:{"click .opening-on-date":"onDateLinkClicked"},onDateLinkClicked:function(t){e("#date-tabs").find("[data-date-iso='"+this.model.get("isoDate")+"']").click()},templateHelpers:{formatTime:function(){return s.parseZone(this.isoDate).format("dddd, MMMM Do")}}}),r.openingOnCollectionView=o.CollectionView.extend({childView:r.OpeningOnView,childViewOptions:{},initialize:function(e){this.el=e.el,this.showtimesQueryModel=e.showtimesQueryModel,this.controller=e.controller,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel,this.childViewOptions.controller=e.controller}}),r.DatePicker=o.ItemView.extend({initialize:function(e){this.el=e.el,this.controller=e.controller},events:{"click .item:not(.active)":"onDateItemClicked"},onDateItemClicked:function(t){var i=e(t.currentTarget).data("date-iso"),o=e(".showtime-mobile-nav, .carousel");e(".item",o).removeClass("active"),e(".item[data-date-iso="+i+"]",o).addClass("active"),e(".showtime-mobile-nav button .text").text(e(".showtime-mobile-nav .item.active").text()),this.controller.onDatePickerChanged(i.replace(/-/g,""))},setDate:function(t){var i=e(".showtime-mobile-nav, .carousel");e(".item",i).removeClass("active"),e(".item[data-date-iso="+t.substring(0,4)+"-"+t.substring(4,6)+"-"+t.substring(6,8)+"]",i).addClass("active"),e(".showtime-mobile-nav button .text").text(e(".showtime-mobile-nav .item.active").text())}}),r.LocationPicker=o.ItemView.extend({events:{"click #location-change-link":"onChangeLocationClicked",keydown:"filterKey"},initialize:function(t){this.el=t.el,this.controller=t.controller,l.initializeGoogleAutocomplete(e(".typeahead")[0],this),t.location&&this.updateLocation(t.location)},applyNewLocation:function(e){this.$(".typeahead").val(e.displayName),this.location&&this.location.placeId==e.placeId?this.updateLocation(e):(this.location=e,this.controller.onZipcodeChanged(e),this.updateLocation(e))},onChangeLocationClicked:function(){this.$(".typeahead").show(),this.$(".zipcode").hide(),this.$("#location-change-link").hide(),this.$("#location-button").show(),this.$(".typeahead").focus()},updateLocation:function(e){this.location=e,this.$(".typeahead").hide(),this.$(".text .zipcode").html(this.location.displayName),this.$(".text .zipcode").show(),this.$("#location-change-link").show(),this.$("#location-button").hide()}}),r.MovieListClear=o.ItemView.extend({events:{"click #movie-list-clear":"onMovieListClear"},initialize:function(e){this.el=e.el,this.controller=e.controller,this.queryModel=e.showtimesQueryModel,this.listenTo(this.queryModel,"change:selectedMovieIds",this.render)},render:function(){return this.queryModel.get("selectedMovieIds").length>0?this.$("#movie-list-clear").css("visibility","visible"):this.$("#movie-list-clear").css("visibility","hidden"),this},onMovieListClear:function(){this.queryModel.clearAllSelectedMovieIds(),this.controller.onMoviePickerClear()}}),r.TheaterListClear=o.ItemView.extend({events:{"click #theater-list-clear":"onTheaterListClear"},initialize:function(e){this.el=e.el,this.controller=e.controller,this.queryModel=e.showtimesQueryModel,this.listenTo(this.queryModel,"change:selectedTheaterIds",this.render),this.render()},render:function(){return this.queryModel.get("selectedTheaterIds").length>0?this.$("#theater-list-clear").css("visibility","visible"):this.$("#theater-list-clear").css("visibility","hidden"),this},onTheaterListClear:function(){this.queryModel.resetLimit(),this.queryModel.clearAllSelectedTheaterIds(),this.controller.onTheaterPickerClear()}}),r.MovieListItem=o.ItemView.extend({tagName:"li",className:"checkbox",template:t.template(e("script.MovieListItemTemplate").html()),events:{click:"onCheckboxSelected"},initialize:function(e){this.controller=e.controller,this.showtimesQueryModel=e.showtimesQueryModel,this.listenTo(this.showtimesQueryModel,"change:clearAllSelectedMovieIds",this.clearCheckbox),this.listenTo(this.showtimesQueryModel,"change:isLoading",this.onLoading)},onCheckboxSelected:function(){this.updateQueryModel(),this.controller.onMoviePickerChanged(this.model.get("id"),this.$(".movie-list-checkbox").hasClass("checked"))},clearCheckbox:function(e){this.$(".movie-list-checkbox").removeClass("checked")},updateQueryModel:function(){var e=parseInt(this.model.get("id"));e&&(this.showtimesQueryModel.get("selectedMovieIds").indexOf(e)>=0?this.$(".movie-list-checkbox").removeClass("checked"):this.$(".movie-list-checkbox").addClass("checked"))},onLoading:function(){this.showtimesQueryModel.get("isLoading")?e("#movie-picker").siblings().find("input[type='checkbox']").attr("disabled",!0):e("#movie-picker").siblings().find("input[type='checkbox']").attr("disabled",!1)}}),r.TheaterListItem=o.ItemView.extend({tagName:"li",className:"checkbox",template:t.template(e("script.TheaterListItemTemplate").html()),events:{click:"onCheckboxSelected"},initialize:function(e){this.controller=e.controller,this.showtimesQueryModel=e.showtimesQueryModel,this.listenTo(this.showtimesQueryModel,"change:clearAllSelectedTheaterIds",this.clearCheckbox),this.listenTo(this.showtimesQueryModel,"change:isLoading",this.onLoading),this.theaterGroupCode=e.theaterGroupCode,"FLX"===this.model.get("ticketSource")&&this.model.set("hasFLX")},onCheckboxSelected:function(t){var i=Number(e(".theater-list-checkbox",t.currentTarget).attr("value"));this.showtimesQueryModel.get("selectedTheaterIds").indexOf(i)>=0?(this.showtimesQueryModel.removeSelectedTheaterId(i),this.$(".theater-list-checkbox").removeClass("checked"),this.controller.onTheaterPickerChanged(i,!1)):(this.showtimesQueryModel.putSelectedTheaterId(i),this.$(".theater-list-checkbox").addClass("checked"),this.controller.onTheaterPickerChanged(i,!0))},clearCheckbox:function(){this.$(".theater-list-checkbox").removeClass("checked")},onLoading:function(){this.showtimesQueryModel.get("isLoading")?e("#"+this.theaterGroupCode).siblings().find("input[type='checkbox']").attr("disabled",!0):e("#"+this.theaterGroupCode).siblings().find("input[type='checkbox']").attr("disabled",!1)}}),r.MovieListSelectorItem=o.ItemView.extend({tagName:"li",template:t.template("<@= title @>"),events:{click:"onOptionSelected"},initialize:function(e){this.parentView=e.parentView},onOptionSelected:function(){this.parentView.onOptionSelected(this.model.get("id"))}}),r.MovieListSelector=o.CollectionView.extend({childView:r.MovieListSelectorItem,childViewOptions:{},initialize:function(e){this.el=e.el,this.queryModel=e.queryModel,this.controller=e.controller,this.collection=e.movieListCollectionModel,this.viewableCollection=e.viewableCollection,this.childViewOptions.parentView=this,this.listenTo(this.collection,"remove",this.render)},onOptionSelected:function(e){var t=this.collection.where({id:e})[0];t&&(this.collection.remove(t),this.viewableCollection.set(t,{remove:!1}),this.controller.onMovieAddedToList(t),this.render())}}),r.OpeningCompositeView=o.CompositeView.extend({template:t.template("<p class='list-title text-uppercase'>Opening <@= formatTime() @></p><ul class='list-selector'></ul>"),childView:r.MovieListItem,childViewOptions:{},childViewContainer:".list-selector",initialize:function(e){this.controller=e.controller,this.childViewOptions.controller=e.controller,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel,this.collection=new Backbone.Collection(this.model.get("movies"))},templateHelpers:{formatTime:function(){return s.parseZone(this.isoDate).format("dddd, MMMM Do")}}}),r.OpeningCollectionView=o.CollectionView.extend({el:"#opening-lists",childView:r.OpeningCompositeView,childViewOptions:{},initialize:function(e){this.childViewOptions.controller=e.controller,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel},setSelectedMovies:function(e){this.$(".movie-list-checkbox").removeClass("checked");for(var t=0;t<e.length;++t)this.$(".movie-list-checkbox[value="+e[t]+"]").addClass("checked")}}),r.TopBoxOfficeCompositeView=o.CompositeView.extend({el:"#boxoffice-list",template:t.template("<p class='list-title text-uppercase'>Top Box Office</p><ul class='list-selector'></ul>"),childView:r.MovieListItem,childViewOptions:{},childViewContainer:".list-selector",initialize:function(e){this.controller=e.controller,this.childViewOptions.controller=e.controller,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel},setSelectedMovies:function(e){this.$(".movie-list-checkbox").removeClass("checked");for(var t=0;t<e.length;++t)this.$(".movie-list-checkbox[value="+e[t]+"]").addClass("checked")}}),r.OtherCompositeView=o.CompositeView.extend({el:"#other-list",template:t.template("<p class='list-title text-uppercase'>Other</p><ul class='list-selector'></ul>"),childView:r.MovieListItem,childViewOptions:{},childViewContainer:".list-selector",initialize:function(e){this.collection=e.collection,this.controller=e.controller,this.childViewOptions.controller=e.controller,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel},onRender:function(){this.$(".movie-list-checkbox").each(function(){e(this).addClass("checked")})}}),r.PurchaseButtonItemView=o.ItemView.extend({tagName:"span",className:"purchase-buttons",template:t.template(e("script.PurchaseButtonTemplate").html()),events:{click:"trackMovieTicketsAffiliateEvent"},initialize:function(e){this.model.set("movieId",e.movieId),this.model.set("theaterData",e.theaterData)},onBeforeRender:function(){if(this.model.get("purchaseExpiry")){var t=s(this.model.get("purchaseExpiry")),i=t.diff();i>0&&(this.timer=setTimeout(function(){e("#"+this.model.get("code")).attr("disabled",!0)}.bind(this),i))}},onDestroy:function(){this.timer&&window.clearTimeout(this.timer)},templateHelpers:{formatTime:function(e){return s.parseZone(e).format("h:mma")},movieData:function(){return new Backbone.Collection(this.theaterData.get("movies")).get(this.movieId)}},trackMovieTicketsAffiliateEvent:function(){"Krux"in window&&Krux("admEvent","Jeq4dSBI",{})}}),r.TraitGroupsCompositeView=o.CompositeView.extend({className:"trait-group",template:t.template(e("script.TraitGroupTemplate").html()),childView:r.PurchaseButtonItemView,childViewOptions:{},childViewContainer:".performances",initialize:function(e){this.childViewOptions.theaterData=e.theaterData,this.childViewOptions.movieId=e.movieId,this.model.set("presentationName",this.model.collection.presentationName),this.model.set("parentModel",e.parentModel),this.collection=new Backbone.Collection(this.model.get("performances")),this.childViewOptions.parentModel=e.parentModel},templateHelpers:{traitData:function(e){return this.parentModel.get("traits").get(e).name}}}),r.PresentationCompositeView=o.CollectionView.extend({className:"presentation",childView:r.TraitGroupsCompositeView,childViewOptions:{},initialize:function(e){this.childViewOptions.theaterData=e.theaterData,this.childViewOptions.movieId=e.movieId,this.childViewOptions.parentModel=e.parentModel,this.collection=new Backbone.Collection(this.model.get("traitGroups")),this.collection.presentationName=e.parentModel.get("presentations").get(this.model.get("name")).name}}),r.ShowtimesDetailMovieCompositeView=o.CompositeView.extend({template:t.template(e("script.MovieDetailsTemplate").html()),childView:r.PresentationCompositeView,childViewOptions:{},childViewContainer:".showtimes-presentations",attributes:function(){return{class:"row movie-details-row",id:this.model.get("id")}},initialize:function(e){this.childViewOptions.theaterData=e.theaterData,this.childViewOptions.movieId=this.model.get("id"),this.childViewOptions.parentModel=e.parentModel,this.collection=new Backbone.Collection(this.model.get("presentations")),this.controller=e.controller,this.model.set("parentModel",e.parentModel),this.model.set("hideMovieInfo",e.hideMovieInfo)},templateHelpers:{movieData:function(){return this.parentModel.get("movies").get(this.id).toJSON()},audienceData:function(){var e={},t=this.parentModel.get("movies").get(this.id),i=t.get("reviews");return i&&i.flixster&&new Date<Date.parse(t.get("releaseDate")+" 00:00:00")?(e.ratingType="wtsni",e.ratingScore=Math.round(100*i.flixster.numWantToSee/(i.flixster.numWantToSee+i.flixster.numNotInterested)),e.ratingClass="wts"):i&&i.flixster&&(e.ratingType="viewed",e.ratingScore=i.flixster.likeability,i.flixster.likeability<60?e.ratingClass="spilled":e.ratingClass="popcorn"),e}}}),r.MovieListCollection=o.CollectionView.extend({childView:r.MovieListItem,childViewOptions:{},initialize:function(e){t.bindAll(this,"render"),this.controller=e.controller,this.childViewOptions.controller=e.controller,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel}}),r.TheaterListCompositeView=o.CompositeView.extend({className:"theater-list",template:t.template("<p class='list-title text-uppercase'><@= name @></p> <ul class='list-selector' id='<@= code @>'></ul>"),childView:r.TheaterListItem,childViewOptions:{},childViewContainer:".list-selector",initialize:function(e){this.collection=new Backbone.Collection,this.parent=e.parent,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel,this.childViewOptions.controller=e.controller,this.childViewOptions.theaterGroupCode=this.model.get("code"),this.setTheaterCollection()},setTheaterCollection:function(){for(var e=this.model.get("theaters"),t=0;t<e.length;t++)this.collection.add(this.parent.theaterData.get(e[t],{at:t}))}}),r.TheaterListCollection=o.CollectionView.extend({childView:r.TheaterListCompositeView,childViewOptions:{},initialize:function(e){t.bindAll(this,"render"),this.controller=e.controller,this.childViewOptions.controller=e.controller,this.childViewOptions.parent=this,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel},setSelectedTheaters:function(e){this.$(".theater-list-checkbox").removeClass("checked");for(var t=0;t<e.length;++t)this.$(".theater-list-checkbox[value="+e[t]+"]").addClass("checked")}}),r.ShowtimesCompositeView=o.CompositeView.extend({template:t.template(e("script.ShowtimesCompositeViewTemplate").html()),childView:r.ShowtimesDetailMovieCompositeView,childViewOptions:{},childViewContainer:".movie-showtimes-item",attributes:function(){return{class:"theater",id:this.model.get("id")}},templateHelpers:function(){return{isFandangoTicketingEnabled:"true"===this.controller.isFandangoTicketingEnabled}},initialize:function(e){this.showtimesQueryModel=e.showtimesQueryModel,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel,this.controller=e.controller,this.childViewOptions.theaterData=this.model,this.childViewOptions.controller=e.controller,this.childViewOptions.parentModel=e.parentModel,this.childViewOptions.hideMovieInfo=e.hideMovieInfo,this.collection=new Backbone.Collection(this.model.get("movies")),this.model.set("hideTheaterInfo",e.hideTheaterInfo)},attachBuffer:function(e){var t=this.getChildViewContainer(e),i=this._createBuffer(e);t.html(i)}}),r.ShowtimesTheaterGroupCollectionView=o.CollectionView.extend({childView:r.ShowtimesCompositeView,childViewOptions:{},initialize:function(e){this.el=e.el,this.controller=e.controller,this.childViewOptions.showtimesQueryModel=e.showtimesQueryModel,this.childViewOptions.controller=e.controller,this.childViewOptions.parentModel=e.parentModel,this.childViewOptions.hideTheaterInfo=!1,this.childViewOptions.hideMovieInfo=!1},hideTheaterInfo:function(){this.childViewOptions.hideTheaterInfo=!0},hideMovieInfo:function(){this.childViewOptions.hideMovieInfo=!0},showTheaterInfo:function(){this.childViewOptions.hideTheaterInfo=!1},showMovieInfo:function(){this.childViewOptions.hideMovieInfo=!1}}),r.MovieInformation=o.ItemView.extend({template:t.template(e("script.ShowtimesMovieInfo").html()),initialize:function(e){this.el=e.el},serializeData:function(){var e={title:this.model.get("title"),posterImgSrc:this.model.get("poster").profile,vanityUrl:this.model.get("vanityUrl"),mpaaRating:this.model.get("mpaaRating"),theaterReleaseDate:s(this.model.get("releaseDate"),"YYYY-MM-DD").format("MMM D, YYYY"),runningTime:this.model.get("runningTime")};return this.model.get("reviews").rottenTomatoes&&(e.critic={ratingScore:this.model.get("reviews").rottenTomatoes.rating},this.model.get("reviews").rottenTomatoes.certifiedFresh?e.critic.ratingClass="certified":this.model.get("reviews").rottenTomatoes.rating>=60?e.critic.ratingClass="fresh":e.critic.ratingClass="rotten",e.consensus=this.model.get("reviews").rottenTomatoes.consensus),this.model.get("reviews").flixster&&((new Date).valueOf()<Date.parse(this.model.get("releaseDate"))?(e.audience={ratingType:"wtsni",ratingScore:Math.ceil(100*this.model.get("reviews").flixster.numWantToSee/(this.model.get("reviews").flixster.numWantToSee+this.model.get("reviews").flixster.numNotInterested)+.5)},e.audience.ratingClass="wts"):(e.audience={ratingType:"viewed",ratingScore:this.model.get("reviews").flixster.likeability},this.model.get("reviews").flixster.likeability<60?e.audience.ratingClass="spilled":e.audience.ratingClass="popcorn")),e},show:function(t){e(this.parentEl).html(this.$el),e(".showtimes-body",t.$el).addClass("single-movie"),this.$el.removeClass("hide")},hide:function(t){e(".showtimes-body",t.$el).removeClass("single-movie"),this.$el.addClass("hide")}}),r.TheaterInformation=o.ItemView.extend({classNames:"theaterInfo",id:"theaterInfo",template:t.template(e("script.ShowtimesTheaterInfo").html()),initialize:function(e){this.el=e.el},serializeData:function(){return{title:this.model.get("name"),address:this.model.get("address"),phone:this.model.get("phone"),friendlyPhone:n(this.model.get("callablePhone"))}},show:function(t){e(this.parentEl).html(this.$el),e(".theater-heading",t.$el).hide(),this.$el.removeClass("hide")},hide:function(t){e(".theater-heading",t.$el).show(),this.$el.addClass("hide")}}),r});
//# sourceMappingURL=ShowtimesView.min.js.map